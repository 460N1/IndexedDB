let indexedDB=window.indexedDB||window.webkitIndexedDB||window.mozIndexedDB;function DB(e){this.init=((t,r)=>{let a=indexedDB.open(e,t);a.onsuccess=(e=>{let a=e.target.result;if("setVersion"in a&&a.version<t){a.setVersion(t).onsuccess=(e=>r(e.target.result.db))}}),a.onupgradeneeded=(e=>r(e.target.result))}),this.read=((e,t)=>this.transaction("readonly",e,t)),this.readWrite=((e,t)=>this.transaction("readwrite",e,t)),this.transaction=((t,r,a)=>{indexedDB.open(e).onsuccess=(e=>{let s=e.target.result.transaction(r,t);s.oncomplete=(e=>{}),a(s)})})}let databaseName="StorageDB",dbStore="storage",storageDB=new DB(databaseName);storageDB.init(1,e=>e.createObjectStore(dbStore,{keyPath:"key"})),insert=((e,t)=>storageDB.readWrite([dbStore],r=>r.objectStore(dbStore).put({key:e,value:t}))),readSource=(e=>storageDB.read([dbStore],t=>t.objectStore(dbStore).get(e).onsuccess=(t=>dataURL(e,t.target.result,t=>setSource(e,t))))),setSource=((e,t)=>{let r=document.querySelectorAll(`[data-src="${e}"]`)[0];r.setAttribute("LINK"==r.tagName?"href":"src",t),r.removeAttribute("data-src")}),dataURL=((e,t,r)=>{if(t)return r(t.value);let a=new XMLHttpRequest;a.open("GET",e,!0),a.responseType="arraybuffer",a.send(),a.onload=(()=>{if(200!=a.status)return;let t=new Uint8Array(a.response),s=t.length,n=new Array(s);for(;s--;)n[s]=String.fromCharCode(t[s]);let o=n.join(""),d=`data:${dataType(e)};base64,${window.btoa(o)}`;insert(e,d),r(d)})}),dataType=(e=>{let t=e.split(".")[e.split(".").length-1];switch(t){case"mp4":case"webm":return"video/"+t;case"js":return"text/javascript";case"css":return"text/"+t;default:return"image/"+t}}),selfDestruct=(e=>document.getElementById(e).parentNode.removeChild(document.getElementById(e))),(()=>{let e=document.querySelectorAll("[data-src]");for(let t=0;t<e.length;t++)readSource(e[t].getAttribute("data-src"));var t=document.querySelectorAll("[src*='460n1.caching']")[0];t.parentNode.removeChild(t)})();
