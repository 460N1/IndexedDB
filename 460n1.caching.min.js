let indexedDB=window.indexedDB||window.webkitIndexedDB||window.mozIndexedDB;function DB(e){this.init=(t=>{indexedDB.open(e,1).onupgradeneeded=(e=>t(e.target.result))}),this.read=((e,t)=>this.transaction("readonly",e,t)),this.readWrite=((e,t)=>this.transaction("readwrite",e,t)),this.transaction=((t,r,a)=>{indexedDB.open(e).onsuccess=(e=>{let n=e.target.result.transaction(r,t);a(n)})})}let dbStore="storage",storageDB=new DB("StorageDB");storageDB.init(e=>e.createObjectStore(dbStore,{keyPath:"key"})),insert=((e,t)=>storageDB.readWrite([dbStore],r=>r.objectStore(dbStore).put({key:e,value:t}))),readSource=(e=>storageDB.read([dbStore],t=>t.objectStore(dbStore).get(e).onsuccess=(t=>dataURL(e,t.target.result,t=>setSource(e,t))))),setSource=((e,t)=>{let r=document.querySelectorAll(`[data-src="${e}"]`)[0];r.setAttribute("LINK"==r.tagName?"href":"src",t),r.removeAttribute("data-src")}),dataURL=((e,t,r)=>{if(t)return r(t.value);let a=new XMLHttpRequest;a.open("GET",e,!0),a.responseType="arraybuffer",a.send(),a.onload=(()=>{if(200!=a.status)return;let t=new Uint8Array(a.response),n=t.length,o=new Array(n);for(;n--;)o[n]=String.fromCharCode(t[n]);let s=o.join(""),d=`data:${dataType(e)};base64,${window.btoa(s)}`;insert(e,d),r(d)})}),dataType=(e=>{let t=e.split(".")[e.split(".").length-1];switch(t){case"mp4":case"webm":return"video/"+t;case"js":return"text/javascript";case"css":return"text/"+t;default:return"image/"+t}}),(()=>{let e=document.querySelectorAll("[data-src]");for(let t=0;t<e.length;t++)readSource(e[t].getAttribute("data-src"));let t=document.querySelectorAll("[src*='460n1.caching']")[0];t.parentNode.removeChild(t)})();
